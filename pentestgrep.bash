
#!/bin/bash
#
# Pentest with UNIX grep tool...
# ----------------------------------------------------------------------------
# Simple script for PenTesting.

if [ $# -ne 1 ]; then
    echo "Usage: $(basename "$0") directory-to-grep-through"
    exit 1
fi

# OPTIONS
ADDITIONAL_GREP_ARGUMENTS="-A 1 -B 3 --color=always"
TARGET="./grep-output"
mkdir -p "$TARGET"

DO_JAVA=true
DO_SPRING=true
DO_JSP=true
DO_ANDROID=true
DO_IOS=true
DO_PHP=true
DO_GENERAL=true

# END OPTIONS

GREP_ARGUMENTS="-nrP"
STANDARD_GREP_ARGUMENTS="$ADDITIONAL_GREP_ARGUMENTS $GREP_ARGUMENTS"
SEARCH_FOLDER="$1"

echo "Your standard grep arguments: $STANDARD_GREP_ARGUMENTS"
echo "Output will be put into this folder: $TARGET"
echo "You are currently grepping through folder: $SEARCH_FOLDER"
sleep 2

# Function to search with grep
function search_grep {
    local search_string="$1"
    local outfile="$2"
    echo "Searching for $search_string --> writing to $outfile"
    grep -i $STANDARD_GREP_ARGUMENTS "$search_string" "$SEARCH_FOLDER" > "$TARGET/$outfile"
}

# The Java stuff
if [ "$DO_JAVA" = true ]; then
    search_grep 'javax.crypto|bouncy.*?castle|new\sSecretKeySpec$$|messagedigest' "java_general_crypto.txt"
    search_grep 'toString$$$$ *==|== *toString$$$$|" *==|== *"' "java_general_wrong_string_comparison.txt"
    search_grep '\.exec$$' "java_general_exec.txt"
    search_grep 'java\.net\.|java\.io\.|javax\.servlet|org\.apache\.http' "java_general_io.txt"
    search_grep '@Entity|@ManyToOne|@OneToMany|@OneToOne|@Table|@Column' "java_persistent_beans.txt"
    search_grep '@Table$$|@Column$$' "java_persistent_tables_and_columns_in_database.txt"
    search_grep 'string .{0,10}password|string .{0,10}secret|string .{0,10}key|string .{0,10}cvv|string .{0,10}user|string .{0,10}hash(?!(table|map|set|code))|string .{0,10}passcode|string .{0,10}passphrase|string .{0,10}user|string .{0,10}pin|string .{0,10}credit' "java_confidential_data_in_strings.txt"
fi

# Add similar blocks for DO_SPRING, DO_JSP, DO_ANDROID, DO_IOS, DO_PHP, and DO_GENERAL

echo "Done grep. Results in $TARGET."
